{
    "Version": "2019-10-30",
    "StartAction": "856dd865-e5a0-49c6-aacc-55fe53c38a22",
    "Metadata": {
        "entryPointPosition": {
            "x": 20,
            "y": 18.4
        },
        "ActionMetadata": {
            "Play 1 min of silence": {
                "position": {
                    "x": 797.6,
                    "y": 874.4
                },
                "isFriendlyName": true
            },
            "856dd865-e5a0-49c6-aacc-55fe53c38a22": {
                "position": {
                    "x": 185.6,
                    "y": 14.4
                }
            },
            "d5bd7724-4436-4bfc-bd2a-d0bee26963a1": {
                "position": {
                    "x": 509.6,
                    "y": 18.4
                }
            },
            "410057d0-9390-486b-bbb4-c4def2a7367c": {
                "position": {
                    "x": 512.8,
                    "y": 230.4
                }
            },
            "3f9659a3-56a5-4f3c-a431-fd9da2306459": {
                "position": {
                    "x": 522.4,
                    "y": 641.6
                }
            },
            "Play 100 mins of silence": {
                "position": {
                    "x": 528.8,
                    "y": 872.8
                },
                "isFriendlyName": true
            },
            "99458f47-6941-48ce-9b90-fdf184759b22": {
                "position": {
                    "x": 1106.4,
                    "y": 1140
                }
            },
            "07273109-a75a-4742-aaae-ce35603c31fc": {
                "position": {
                    "x": 201.6,
                    "y": 876.8
                }
            },
            "6728609a-9707-41f7-a87c-30ac1fde4f4c": {
                "position": {
                    "x": 185.6,
                    "y": 204.8
                },
                "toCustomer": true,
                "fromCustomer": true
            },
            "97a964a7-5dd2-4c82-b21f-173b209be8a7": {
                "position": {
                    "x": 186.4,
                    "y": 640.8
                },
                "parameters": {
                    "LambdaFunctionARN": {
                        "displayName": "connect-test-j-kvsDgTrigger-xjRHteWE0fXO"
                    }
                },
                "dynamicMetadata": {}
            },
            "Deepgram Configuration": {
                "position": {
                    "x": 181.6,
                    "y": 410.4
                },
                "isFriendlyName": true,
                "dynamicParams": []
            }
        },
        "Annotations": [
            {
                "type": "default",
                "id": "799c9e6d-1b0e-4fb2-8167-698165492867",
                "content": "Configure Deepgram through contact attributes. We can use any parameters available through the Deepgram streaming API. \n\nFor example, we can set \"model=nova\" by setting a contact attribute with key \"model\" and value \"nova\". We can set \"tag=sometag1&tag=sometag2\" by setting a contact attribute with key \"tag\" and value \"sometag1 sometag2\".\n\nThe \"callback\" parameter is where Deepgram will send transcripts. Within this parameter, we can inject the Contact ID of the current call. For example, set key \"callback\" and value \"https://www.example.com/some/path/{contact-id}\"",
                "actionId": "Deepgram Configuration",
                "isFolded": true,
                "position": {
                    "x": 246.16666666666666,
                    "y": 719.6666666666666
                },
                "size": {
                    "height": 295,
                    "width": 300
                }
            }
        ],
        "name": "Sample Deepgram flow",
        "description": "",
        "type": "contactFlow",
        "status": "published",
        "hash": {}
    },
    "Actions": [
        {
            "Parameters": {
                "SSML": "<speak>\n<break time=\"5000ms\"/>\n<break time=\"5000ms\"/>\n<break time=\"5000ms\"/>\n<break time=\"5000ms\"/>\n<break time=\"5000ms\"/>\n<break time=\"5000ms\"/>\n<break time=\"5000ms\"/>\n<break time=\"5000ms\"/>\n<break time=\"5000ms\"/>\n<break time=\"5000ms\"/>\n<break time=\"5000ms\"/>\n<break time=\"5000ms\"/>\n</speak>"
            },
            "Identifier": "Play 1 min of silence",
            "Type": "MessageParticipant",
            "Transitions": {
                "NextAction": "Play 100 mins of silence",
                "Errors": [
                    {
                        "NextAction": "99458f47-6941-48ce-9b90-fdf184759b22",
                        "ErrorType": "NoMatchingError"
                    }
                ]
            }
        },
        {
            "Parameters": {
                "FlowLoggingBehavior": "Enabled"
            },
            "Identifier": "856dd865-e5a0-49c6-aacc-55fe53c38a22",
            "Type": "UpdateFlowLoggingBehavior",
            "Transitions": {
                "NextAction": "d5bd7724-4436-4bfc-bd2a-d0bee26963a1"
            }
        },
        {
            "Parameters": {
                "Text": "This call demonstrates real time transcription with Deepgram."
            },
            "Identifier": "d5bd7724-4436-4bfc-bd2a-d0bee26963a1",
            "Type": "MessageParticipant",
            "Transitions": {
                "NextAction": "6728609a-9707-41f7-a87c-30ac1fde4f4c",
                "Errors": [
                    {
                        "NextAction": "99458f47-6941-48ce-9b90-fdf184759b22",
                        "ErrorType": "NoMatchingError"
                    }
                ]
            }
        },
        {
            "Parameters": {
                "Text": "An error occurred when we tried to start streaming."
            },
            "Identifier": "410057d0-9390-486b-bbb4-c4def2a7367c",
            "Type": "MessageParticipant",
            "Transitions": {
                "NextAction": "99458f47-6941-48ce-9b90-fdf184759b22"
            }
        },
        {
            "Parameters": {
                "Text": "Lambda function failed or timed out."
            },
            "Identifier": "3f9659a3-56a5-4f3c-a431-fd9da2306459",
            "Type": "MessageParticipant",
            "Transitions": {
                "NextAction": "Play 100 mins of silence",
                "Errors": [
                    {
                        "NextAction": "99458f47-6941-48ce-9b90-fdf184759b22",
                        "ErrorType": "NoMatchingError"
                    }
                ]
            }
        },
        {
            "Parameters": {
                "LoopCount": "100"
            },
            "Identifier": "Play 100 mins of silence",
            "Type": "Loop",
            "Transitions": {
                "NextAction": "99458f47-6941-48ce-9b90-fdf184759b22",
                "Conditions": [
                    {
                        "NextAction": "Play 1 min of silence",
                        "Condition": {
                            "Operator": "Equals",
                            "Operands": [
                                "ContinueLooping"
                            ]
                        }
                    },
                    {
                        "NextAction": "99458f47-6941-48ce-9b90-fdf184759b22",
                        "Condition": {
                            "Operator": "Equals",
                            "Operands": [
                                "DoneLooping"
                            ]
                        }
                    }
                ]
            }
        },
        {
            "Parameters": {},
            "Identifier": "99458f47-6941-48ce-9b90-fdf184759b22",
            "Type": "DisconnectParticipant",
            "Transitions": {}
        },
        {
            "Parameters": {
                "Text": "Lambda function invoked successfully.\n"
            },
            "Identifier": "07273109-a75a-4742-aaae-ce35603c31fc",
            "Type": "MessageParticipant",
            "Transitions": {
                "NextAction": "Play 100 mins of silence",
                "Errors": [
                    {
                        "NextAction": "99458f47-6941-48ce-9b90-fdf184759b22",
                        "ErrorType": "NoMatchingError"
                    }
                ]
            }
        },
        {
            "Parameters": {
                "MediaStreamingState": "Enabled",
                "MediaStreamType": "Audio",
                "Participants": [
                    {
                        "ParticipantType": "Customer",
                        "MediaDirections": [
                            "To",
                            "From"
                        ]
                    }
                ]
            },
            "Identifier": "6728609a-9707-41f7-a87c-30ac1fde4f4c",
            "Type": "UpdateContactMediaStreamingBehavior",
            "Transitions": {
                "NextAction": "Deepgram Configuration",
                "Errors": [
                    {
                        "NextAction": "410057d0-9390-486b-bbb4-c4def2a7367c",
                        "ErrorType": "NoMatchingError"
                    }
                ]
            }
        },
        {
            "Parameters": {
                "LambdaFunctionARN": "arn:aws:lambda:us-east-1:764576996850:function:connect-test-j-kvsDgTrigger-xjRHteWE0fXO",
                "InvocationTimeLimitSeconds": "8",
                "ResponseValidation": {
                    "ResponseType": "STRING_MAP"
                }
            },
            "Identifier": "97a964a7-5dd2-4c82-b21f-173b209be8a7",
            "Type": "InvokeLambdaFunction",
            "Transitions": {
                "NextAction": "07273109-a75a-4742-aaae-ce35603c31fc",
                "Errors": [
                    {
                        "NextAction": "3f9659a3-56a5-4f3c-a431-fd9da2306459",
                        "ErrorType": "NoMatchingError"
                    }
                ]
            }
        },
        {
            "Parameters": {
                "Attributes": {
                    "dg_model": "nova",
                    "dg_callback": "https://YOUR-ENDPOINT-HERE.ngrok-free.app/{contact-id}"
                },
                "TargetContact": "Current"
            },
            "Identifier": "Deepgram Configuration",
            "Type": "UpdateContactAttributes",
            "Transitions": {
                "NextAction": "97a964a7-5dd2-4c82-b21f-173b209be8a7",
                "Errors": [
                    {
                        "NextAction": "97a964a7-5dd2-4c82-b21f-173b209be8a7",
                        "ErrorType": "NoMatchingError"
                    }
                ]
            }
        }
    ]
}